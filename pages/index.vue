<template>
  <div class="match__container">
    <div class="contents">
      <div class="title">
        <span>MBTI</span>
        <span>궁합계산기</span>
      </div>
      <div class="person">
        <div
          :class="['solo', 'btn', {'on': pSwitch == 'solo'}]"
          @click="pSwitch = 'solo'; flipCard($event)"
        >
          <div class="img" />
        </div>
        <div
          :class="['people', 'btn', {'on': pSwitch == 'people'}]"
          @click="pSwitch = 'people'; flipCard($event)"
        >
          <div class="img" />
          <div class="img" />
        </div>
      </div>
      <div class="mbti">
        <div v-if="pSwitch == 'solo'" class="mbti-solo">
          <div class="txt">
            나의 성격유형을 알아보쟝!!..😂
          </div>
          <div class="mbti-select">
            <mbti-card
              v-for="(item, index) in 4"
              :key="index"
              ref="mbtiCards"
              :idx="index"
            />
          </div>
        </div>
        <div v-else class="mbti-people">
          커플임
        </div>
      </div>
      <div class="result">
        <div class="result-btn">
          <div
            v-if="pSwitch == 'solo'"
            @click="soloResult"
          >
            내 성향보기
          </div>
          <div v-else>
            궁합보기
          </div>
        </div>
      </div>
      <div class="test" />
    </div>
  </div>
</template>

<script>
// import axios from 'axios'
import MbtiCard from '~/components/MbtiCard'

export default {
    name: 'IndexPage',
    components: { MbtiCard },
    data () {
        return {
            pSwitch: 'people',
            resData: null
        }
    },
    methods: {
        flipCard (event) {
            const cardInner = event.currentTarget.querySelector('.card-inner')
            if (!cardInner) { return }

            cardInner.style.transform = 'rotateX(180deg)'
            setTimeout(() => {
                const frontText = cardInner.querySelector('.card-front')
                const backText = cardInner.querySelector('.card-back')

                if (!frontText || !backText) { return }

                const temp = frontText.textContent
                frontText.textContent = backText.textContent
                backText.textContent = temp

                cardInner.style.transform = 'rotateX(0deg)'
            }, 600)
        },
        async soloResult () {
            const cardInners = this.$refs.mbtiCards.map(card => card.isFlipped)
            const firstCard = cardInners[0] === false ? 'I' : 'E'
            const secondCard = cardInners[1] === false ? 'N' : 'S'
            const thridCard = cardInners[2] === false ? 'F' : 'T'
            const fourCard = cardInners[3] === false ? 'P' : 'J'
            const sumCard = firstCard + secondCard + thridCard + fourCard
            try {
                const res = await this.$api.get('/', { params: { sumCard } })
                this.resData = res.data
                console.log('aaaa', this.resData)
            } catch (err) {
                console.error(err)
            }
        }
    }
}
</script>

<style lang="scss" scoped>
    @import '~assets/css/intro.scss';
</style>
